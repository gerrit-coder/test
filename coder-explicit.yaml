# Coder configuration file with explicit CORS settings for Gerrit integration
# This version uses environment variables for flexibility

# HTTP server configuration
http:
  # Enable CORS for cross-origin requests
  cors:
    # Allow requests from Gerrit server (uses GERRIT_URL environment variable)
    allow_origins:
      - "${GERRIT_URL:-http://127.0.0.1:8080}"  # Gerrit server URL from environment
      - "http://127.0.0.1:8080"    # Local development fallback
    # Allow necessary HTTP methods
    allow_methods:
      - GET
      - POST
      - DELETE
      - OPTIONS
    # Allow required headers
    allow_headers:
      - Content-Type
      - Coder-Session-Token
      - Authorization
      - Accept
    # Allow credentials if needed
    allow_credentials: true
    # Explicitly enable CORS
    enabled: true

# Server configuration
server:
  # Bind to all interfaces to allow external access (uses CODER_PORT environment variable)
  bind_address: "0.0.0.0:${CODER_PORT:-3000}"

# Security settings
security:
  # Allow insecure connections for development
  # In production, use proper TLS certificates
  allow_insecure_cookies: true

# Logging configuration
log:
  level: "info"
  format: "json"
